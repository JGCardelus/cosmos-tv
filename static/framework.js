//Global variables
const DEBUG = false;
let allowPageChange = true;

//CONNECT TO SERVER
let socket = null;

function connectServer() {
    //$SOCKET_IP
      socket = io.connect("http://192.168.2.51:8080"); //This line was autogenerated.

    socket.emit('validate_connection');
    socket.on('connection_validated', function() {
        console.log("Connected to server. Welcome back");
    });

}

function loadMDC() {
    $('.button').addClass('mdc-ripple-surface');
    $('.button').attr('data-mdc-auto-init', 'MDCRipple');

    $('.round-button').addClass('mdc-ripple-surface');
    $('.round-button').attr('data-mdc-auto-init', 'MDCRipple');

    $('.fab').addClass('mdc-ripple-surface');
    $('.fab').attr('data-mdc-auto-init', 'MDCRipple');

    $('.card').addClass('mdc-elevation--z4');

    $('.mdc-icon-button').attr('data-mdc-auto-init', 'MDCRipple');
    $('.mdc-fab').attr('data-mdc-auto-init', 'MDCRipple');

    mdc.autoInit();
}

function startEnvironment() {
    if (!DEBUG) {
        connectServer();
    }
    loadMDC();
}

startEnvironment();

//PAGE BEHAVIOUR
let windowWidth = $(window).width();
let windowHeight = $(window).height();

$(window).on('resize', function() {
    windowWidth = $(window).width();
    windowHeight = $(window).height();
});

//TABS
let tabs = [];

//NOTIFICATIONS
const SHORT = 2500;
const LONG = 5000;
let notificationSpan = null;
function startNotification(message, color, emphasis, time)
{
    let nContainer = $('#notification-container');
    hardEndNotification();
    nContainer.css('z-index', '600');
    let notification_html = `<div class="notification side-button">
                    <p class="`+ color +` round-left">` + message +  `</p>
                    <button class="button ` + emphasis + ` fill round-right">
        				<span class="icons">done</span>
        			</button>
        		</div>`

    nContainer.html(notification_html);
    nContainer.animate({
        bottom: '1.5rem'
    }, 500);

    notificationSpan = setTimeout(function(){
        endNotification();
    }, time);

    $('#notification-container .notification button').click(function()
    {
        endNotification();
    });
}

function hardEndNotification()
{
    clearTimeout(notificationSpan);
    let nContainer = $('#notification-container');
    nContainer.css('bottom', '-4.775rem');
    nContainer.css('z-index', '0');
    nContainer.html("");
}

function endNotification()
{
    clearTimeout(notificationSpan);
    let nContainer = $('#notification-container');
    nContainer.animate({
        bottom: '-4.775rem'
    }, 500, function()
    {
        nContainer.css('z-index', '0');
        nContainer.html("");
    });
}

function raiseNotification(message, time)
{
    startNotification(message, 'primary', 'secondary', time);
}

function raiseError(message, time)
{
    startNotification(message, 'error', 'white-bg', time);
}
